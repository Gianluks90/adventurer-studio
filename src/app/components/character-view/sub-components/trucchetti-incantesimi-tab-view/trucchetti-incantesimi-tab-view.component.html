<!-- <div class="main-trucchetti-incantesimi-container"> -->
<div as-section-title>Trucchetti e Incantesimi</div>
<div class="ti-container">
    <div class="ti-element"> <span class="ti-label">Classe Incantatore</span> {{classeIncantatore}}</div>
    <div class="ti-element"> <span class="ti-label">Caratteristica</span> {{caratteristicaIncantatore}}</div>
</div>
<div class="ti-container">
    <div class="ti-element"> <span class="ti-label">CD Tiro salvezza</span> {{CDTiroSalvezza}}</div>
    <div class="ti-element"> <span class="ti-label">Bonus attacco</span> +{{bonusAttaccoIncantesimi}}</div>
</div>
<div as-subtitle>Slot Incantesimi</div>
<div class="slot-container-line">
    @for(slot of slotIncantesimi; track i; let i = $index) {
        <!-- <div *ngFor="let slot of slotIncantesimi; let i = index;"> -->
            <div class="risorsa-container" *ngIf="slot.used.length > 0">
                <div class="risorsa-title">{{showLevel(i+1)}}</div>
                <div *ngFor="let used of slot.used; let j = index" [ngClass]="{'active': !used, 'used': used}" class="resource-circle"
                    (click)="useSlot(i, j)">
                    <div class="material-symbols-outlined">circle</div>
                </div>
            </div>
        <!-- </div> -->
    } @empty {
        <div as-description-text>Il personaggio non possiede alcun slot incantesimo.</div>
    }
</div>

<div as-subtitle>Elenco</div>
<!-- <div class="search-container"> -->
    <!-- <mat-form-field appearance="outline" class="search-input" color="accent">
        <mat-icon matPrefix>search</mat-icon>
        <input matInput type="text" (keyup)="filterSearch($event)">
    </mat-form-field> -->
    <div as-mini-buttons-container>
        <button as-mini-circle-btn (click)="collapseAll()">
            <div class="material-symbols-outlined">unfold_less</div>
        </button>
        <button as-mini-circle-btn (click)="openResourcesDialog()">
            <div class="material-symbols-outlined material-no-fill">create_new_folder</div>
        </button>
        <button as-mini-circle-btn (click)="openAddSpellDialog()" *ngIf="!isCampaign">
            <div class="material-symbols-outlined">add</div>
        </button>
    </div>

<!-- </div> -->
<div as-subtitle>Trucchetti</div>
@for (t of lista; track i; let i = $index) {
    @if(t.livello === 0) {
        <details as-details [hidden]="t.filtered" id="details-m">
            <summary as-summary as-summary-with-icon>
                <div class="t-header-container">
                    <img class="spell-icon" [src]="t.icon">
                    <div class="spell-level">{{showLevel(t.livello)}} <sup *ngIf="t.livelloSuperiore">
                        <div class="material-symbols-outlined material-mini">arrow_upward</div>
                    </sup> 
                </div>
                </div>
                <div>{{t.nome}}</div>
            </summary>
            <div class="spell-attributes">{{t.tipologia}}<span *ngIf="t.livello > 0"> di {{t.livello}}° Livello</span>,
                {{t.scuola === 'Altro' ? t.scuolaPersonalizzata : t.scuola}}, {{t.componenti}}, {{t.riferimento}}</div>
            <div class="spell-info"> <span class="spell-label">Durata</span> {{t.durata}} <span class="spell-label">Tempo di
                    lancio</span> {{t.tempoLancio}} <span class="spell-label">Gittata</span> {{t.gittata}} <span
                    class="spell-label">Formula </span>{{t.formula !== '' ? t.formula : '-'}}
            </div>
            <div class="spell-description"> <span class="spell-label">Descrizione</span> {{t.descrizione}}</div>
            <div *ngIf="t.livelloSuperiore !== ''" class="spell-description"> <span class="spell-label">Ai livelli
                    superiori</span> {{t.livelloSuperiore}}
            </div>
            <!-- <div class="button-container">
                <button class="edit-spell-button" (click)="prepareToggle(t)">Non preparato</button>
                <button class="edit-spell-button" (click)="openAddSpellDialog(t, i)">Modifica</button>
            </div> -->
            <div as-buttons-container as-buttons-container-details>
                <button as-btn (click)="prepareToggle(t)">
                    <div class="material-symbols-outlined">{{t.prepared ? 'arrow_upward' : 'arrow_downward'}}</div> <div>{{!t.prepared ? 'Rimuovi' : 'Prepara'}}</div>
                </button>
                <button as-btn (click)="openAddSpellDialog(t, i)">
                    <div class="material-symbols-outlined">edit</div> Modifica
                </button>
            </div>
        </details>
    }
} @empty {
    <div as-description-text>Il personaggio non possiede alcun trucchetto.</div>
}
<div as-subtitle>Preparati <span *ngIf="charData.magia.incantesimiPreparabili > 0" [ngClass]="{'warn-prepared-spells': checkPreparedSpell() > charData.magia.incantesimiPreparabili}">({{checkPreparedSpell()}}/{{charData.magia.incantesimiPreparabili}})</span></div>
@for (t of lista; track i; let i = $index) {
    @if(t.preparato && t.livello > 0) {
        <details *ngIf="t.preparato && t.livello > 0" as-details [hidden]="t.filtered" id="details-m">
            <summary as-summary as-summary-with-icon>
                <div class="t-header-container">
                    <img class="spell-icon" [src]="t.icon">
                    <div class="spell-level">{{showLevel(t.livello)}} <sup *ngIf="t.livelloSuperiore">
                        <div class="material-symbols-outlined material-mini">arrow_upward</div>
                    </sup> 
                </div>
                </div>
                <div>{{t.nome}}</div>
            </summary>
            <div class="spell-attributes">{{t.tipologia}}<span *ngIf="t.livello > 0"> di {{t.livello}}° Livello</span>,
                {{t.scuola === 'Altro' ? t.scuolaPersonalizzata : t.scuola}}, {{t.componenti}}, {{t.riferimento}}</div>
            <div class="spell-info"> <span class="spell-label">Durata</span> {{t.durata}} <span class="spell-label">Tempo di
                    lancio</span> {{t.tempoLancio}} <span class="spell-label">Gittata</span> {{t.gittata}} <span
                    class="spell-label">Formula </span>{{t.formula !== '' ? t.formula : '-'}}
            </div>
            <div class="spell-description"> <span class="spell-label">Descrizione</span> {{t.descrizione}}</div>
            <div *ngIf="t.livelloSuperiore !== ''" class="spell-description"> <span class="spell-label">Ai livelli
                    superiori</span> {{t.livelloSuperiore}}
            </div>
            <!-- <div class="button-container">
                <button class="edit-spell-button" (click)="prepareToggle(t)">Non preparato</button>
                <button class="edit-spell-button" (click)="openAddSpellDialog(t, i)">Modifica</button>
            </div> -->
            <div as-buttons-container as-buttons-container-details>
                <button as-btn (click)="prepareToggle(t)">
                    <div class="material-symbols-outlined">{{t.prepared ? 'arrow_upward' : 'arrow_downward'}}</div> <div>{{!t.prepared ? 'Rimuovi' : 'Prepara'}}</div>
                </button>
                <button as-btn (click)="openAddSpellDialog(t, i)">
                    <div class="material-symbols-outlined">edit</div> Modifica
                </button>
            </div>
        </details>
    }
} @empty {
    <div as-description-text>Il personaggio non possiede alcun incantesimo preparato.</div>
}

<!-- <ng-container *ngFor="let t of lista; let i = index;">
    <details *ngIf="t.preparato && t.livello > 0" as-details [hidden]="t.filtered" id="details-m">
        <summary as-summary as-summary-with-icon>
            <div class="t-header-container">
                <img class="spell-icon" [src]="t.icon">
                <div class="spell-level">{{showLevel(t.livello)}} <sup *ngIf="t.livelloSuperiore">
                    <div class="material-symbols-outlined material-mini">arrow_upward</div>
                </sup> 
            </div>
            </div>
            <div>{{t.nome}}</div>
        </summary>
        <div class="spell-attributes">{{t.tipologia}}<span *ngIf="t.livello > 0"> di {{t.livello}}° Livello</span>,
            {{t.scuola === 'Altro' ? t.scuolaPersonalizzata : t.scuola}}, {{t.componenti}}, {{t.riferimento}}</div>
        <div class="spell-info"> <span class="spell-label">Durata</span> {{t.durata}} <span class="spell-label">Tempo di
                lancio</span> {{t.tempoLancio}} <span class="spell-label">Gittata</span> {{t.gittata}} <span
                class="spell-label">Formula </span>{{t.formula !== '' ? t.formula : '-'}}
        </div>
        <div class="spell-description"> <span class="spell-label">Descrizione</span> {{t.descrizione}}</div>
        <div *ngIf="t.livelloSuperiore !== ''" class="spell-description"> <span class="spell-label">Ai livelli
                superiori</span> {{t.livelloSuperiore}}
        </div>
        <div as-buttons-container as-buttons-container-details>
            <button as-btn (click)="prepareToggle(t)">
                <div class="material-symbols-outlined">{{t.prepared ? 'arrow_upward' : 'arrow_downward'}}</div> <div>{{!t.prepared ? 'Rimuovi' : 'Prepara'}}</div>
            </button>
            <button as-btn (click)="openAddSpellDialog(t, i)">
                <div class="material-symbols-outlined">edit</div> Modifica
            </button>
        </div>
    </details>
</ng-container> -->
@if(!isCampaign) {
    <div as-subtitle>Conosciuti (non preparati)</div>
    @for(t of lista; track i; let i = $index) {
        <details *ngIf="!t.preparato" as-details [hidden]="t.filtered" id="details-m">
            <summary as-summary as-summary-with-icon>
                <div class="t-header-container">
                    <img class="spell-icon" [src]="t.icon">
                    <div class="spell-level">{{showLevel(t.livello)}} <sup *ngIf="t.livelloSuperiore">
                        <div class="material-symbols-outlined material-mini">arrow_upward</div>
                    </sup> 
                </div>
                </div>
                <div>{{t.nome}}</div>
            </summary>
            <div class="spell-attributes">{{t.tipologia}} <span *ngIf="t.livello > 0">di {{t.livello}}° Livello</span>,
                {{t.scuola}}, {{t.componenti}}, {{t.riferimento}}</div>
            <div class="spell-info"> <span class="spell-label">Durata</span> {{t.durata}} <span class="spell-label">Tempo di
                    lancio</span> {{t.tempoLancio}} <span class="spell-label">Gittata</span> {{t.gittata}} <span
                    class="spell-label">Formula </span>{{t.formula !== '' ? t.formula : '-'}}
            </div>
            <div class="spell-description"> <span class="spell-label">Descrizione</span> {{t.descrizione}}</div>
            <div *ngIf="t.livelloSuperiore !== ''" class="spell-description"> <span class="spell-label">Ai livelli
                    superiori</span> {{t.livelloSuperiore}}
            </div>
            <div as-buttons-container as-buttons-container-details>
                <button as-btn (click)="prepareToggle(t)">
                    <div class="material-symbols-outlined">{{!t.prepared ? 'arrow_upward' : 'arrow_downward'}}</div> <div>{{t.prepared ? 'Rimuovi' : 'Prepara'}}</div>
                </button>
                <button as-btn (click)="openAddSpellDialog(t, i)">
                    <div class="material-symbols-outlined">edit</div> Modifica
                </button>
            </div>
        </details>
    } @empty {
        <div as-description-text>Il personaggio conosce alcun incantesimo.</div>
    }
} @else {
    <div as-description-text>Gli Incantesimi non preparati sono visibili solamente sulla Scheda Personaggio.</div>
}