@if (user && campaignData && charData) {
    <div class="home-container" >
        <div class="header-container">
            <div class="pride-flag-column">
                <div class="red"></div>
                <div class="orange"></div>
                <div class="yellow"></div>
                <div class="green"></div>
                <div class="blue"></div>
                <div class="purple"></div>
            </div>
            <div class="header-info">
                <div class="header-title">
                    {{campaignData.title}}
                </div>
                <div class="title-subtitle">
                    <!-- <div>Stato: {{campaignData.status.statusMessage}}</div> -->
                    <div *ngIf="campaignData.archive">Capitolo {{campaignData.archive.length +1}}</div>
                    <div>Sessioni {{sessionNumber}}</div>
                    @if (campaignData.nextSession) {
                        @if (campaignData.nextSession.toDate() > today){
                            <div>Prossima {{campaignData.nextSession.toDate() | date: 'dd/MM' }}</div>
                        } @else {
                            <div>Prossima prevista per oggi</div>
                        }
                    }
                </div>
            </div>
            <div class="header-date">
                @if (isOwner) {
                    <button as-mini-circle-btn inverted-color (click)="openNextSessionDialog()">
                        <div class="material-symbols-outlined">calendar_month</div>
                    </button>
                }
            </div>
        </div>
        <div class="view-tabs">
            <div class="status-container">
                <app-campaign-char-list [characters]="charData" [isOwner]="isOwner" (selectCharEmitter)="onCharEmitted($event)"></app-campaign-char-list>
            </div>
            <mat-tab-group color="accent" #tabGroup>
                <mat-tab>
                    <ng-template mat-tab-label>
                        <img src="./assets/campaign-tabs-icon/story.svg" class="label-icon" (mouseover)="tooltip.showTooltip($event, 'center', true, 'tab1-tooltip', true)" (mouseleave)="tooltip.hideTooltip()">
                    </ng-template>
                    <app-campaign-story-tab [campaign]="campaignData"
                        [sessionNumber]="sessionNumber" [isOwner]="isOwner"></app-campaign-story-tab>
                </mat-tab>
                <mat-tab>
                    <ng-template mat-tab-label>
                        <img src="./assets/campaign-tabs-icon/quests.svg" class="label-icon" (mouseover)="tooltip.showTooltip($event, 'center', true, 'tab2-tooltip', true)" (mouseleave)="tooltip.hideTooltip()">
                    </ng-template>
                    <app-campaign-quests-tab [campaign]="campaignData" [isOwner]="isOwner"></app-campaign-quests-tab>
                </mat-tab>
                <!-- @if(!isOwner) { -->
                    @defer (when charData) {
                        <mat-tab *ngIf="selectedChar">
                            <ng-template mat-tab-label>
                                <img class="player-tab" [src]="selectedChar.informazioniBase.urlImmaginePersonaggio">
                            </ng-template>
                            <app-campaign-char-tab [character]="selectedChar" [isOwner]="isOwner"></app-campaign-char-tab>
                        </mat-tab>
                    } @loading (minimum 2s) {
                        @if (!isOwner) {
                            <mat-tab>
                                <ng-template mat-tab-label>
                                    <mat-spinner class="accent" diameter="30"></mat-spinner>
                                </ng-template>
                            </mat-tab>
                        }
                    }
                <!-- } -->
                
                <mat-tab>
                    <ng-template mat-tab-label>
                        <img src="./assets/tabs-icons/ally.svg" class="label-icon" (mouseover)="tooltip.showTooltip($event, 'center', true, 'tab3-tooltip', true)" (mouseleave)="tooltip.hideTooltip()">
                    </ng-template>
                    <app-campaign-npc-tab [campaign]="campaignData" [isOwner]="isOwner" [character]="selectedChar"></app-campaign-npc-tab>
                </mat-tab>
                <mat-tab>
                    <ng-template mat-tab-label>
                        <img src="./assets/tabs-icons/inventory.svg" class="label-icon" (mouseover)="tooltip.showTooltip($event, 'center', true, 'tab4-tooltip', true)" (mouseleave)="tooltip.hideTooltip()">
                    </ng-template>
                    <app-campaign-inventory-tab [campaign]="campaignData" [isOwner]="isOwner" [characters]="charData"></app-campaign-inventory-tab>
                </mat-tab>
                <mat-tab>
                    <ng-template mat-tab-label>
                        <img src="./assets/campaign-tabs-icon/rules.svg" class="label-icon" (mouseover)="tooltip.showTooltip($event, 'center', true, 'tab5-tooltip', true)" (mouseleave)="tooltip.hideTooltip()">
                    </ng-template>
                    <app-campaign-entries-tab [entries]="campaignData.entries"
                        [isOwner]="isOwner"></app-campaign-entries-tab>
                </mat-tab>
                <mat-tab>
                    <ng-template mat-tab-label>
                        <img src="./assets/campaign-tabs-icon/trophy.svg" class="label-icon" (mouseover)="tooltip.showTooltip($event, 'center', true, 'tab6-tooltip', true)" (mouseleave)="tooltip.hideTooltip()">
                    </ng-template>
                    <app-campaign-achievements-tab [campaign]="campaignData" [isOwner]="isOwner"
                        [characters]="charData"></app-campaign-achievements-tab>
                </mat-tab>
                <mat-tab>
                    <ng-template mat-tab-label>
                        <img src="./assets/campaign-tabs-icon/encounter.svg" class="label-icon" (mouseover)="tooltip.showTooltip($event, 'center', true, 'tab7-tooltip', true)" (mouseleave)="tooltip.hideTooltip()">
                    </ng-template>
                    <app-campaign-encounter-tab [campaign]="campaignData" [characters]="charData" [isOwner]="isOwner"></app-campaign-encounter-tab>
                </mat-tab>
                <mat-tab *ngIf="isOwner">
                    <ng-template mat-tab-label>
                        <img src="./assets/campaign-tabs-icon/dmScreen.svg" class="label-icon" (mouseover)="tooltip.showTooltip($event, 'center', true, 'tab8-tooltip', true)" (mouseleave)="tooltip.hideTooltip()">
                    </ng-template>
                    <app-master-screen-tab [campaign]="campaignData" [isOwner]="isOwner"></app-master-screen-tab>
                </mat-tab>
                <mat-tab *ngIf="isOwner">
                    <ng-template mat-tab-label>
                        <img src="./assets/tabs-icons/cog.svg" class="label-icon" (mouseover)="tooltip.showTooltip($event, 'center', true, 'tab9-tooltip', true)" (mouseleave)="tooltip.hideTooltip()">
                    </ng-template>
                    <app-campaign-settings-tab [campaign]="campaignData" [characters]="charData"
                        [isOwner]="isOwner"></app-campaign-settings-tab>
                </mat-tab>
            </mat-tab-group>
        </div>
    </div>
}

<div as-bottom-buttons-container as-bottom-left id="menu-button">
    <button as-bottom-btn (click)="openSidenav()">
        <div class="material-symbols-outlined">menu</div>
    </button>
</div>

@if (campaignData) {
    <div as-bottom-buttons-container as-bottom-right id="adventure-button">
        <button as-bottom-btn (click)="toggleNotification()">
            <div class="material-symbols-outlined">notifications</div>
        </button>
        @if(campaignData.adventure && campaignData.adventure !== '' && isOwner) {
            <button as-bottom-btn (click)="toggleAdventure()">
                <div class="material-symbols-outlined">menu_book</div>
            </button>
        }
    </div>
}

@if (adventureData && isOwner) {
    <div class="adventure-sidenav-container" *ngIf="showAdventure" [ngClass]="{'opening-sidenav': showAdventure}">
        <div as-mini-buttons-container>
            <button as-long-circle-btn (click)="editAdventure()">
                <div class="material-symbols-outlined">open_in_new</div> <div>Modifica</div>
            </button>
            <button as-mini-circle-btn (click)="toggleAdventure()">
                <div class="material-symbols-outlined">close</div>
            </button>
        </div>
        <app-adventure-view [adventure]="adventureData"></app-adventure-view>
    </div>
}

@if (logsData) {
    <div class="adventure-sidenav-container" *ngIf="showNotification" [ngClass]="{'opening-sidenav': showNotification}">
        <div as-mini-buttons-container>
            <button *ngIf="isOwner" as-long-circle-btn (click)="clearNotification()" [disabled]="logsData.logs <= 0">
                <div class="material-symbols-outlined">mop</div> <div>Pulisci</div>
            </button>
            <button as-mini-circle-btn (click)="toggleNotification()">
                <div class="material-symbols-outlined">close</div>
            </button>
        </div>
        @for (log of logs; track log.id) {
            <div class="notification-date">
                {{log.createdAt.seconds*1000 | date: 'dd/MM/yyyy HH:mm'}}
            </div>
            <div class="notification-history-container">
                @switch(log.type) {
                    @case ('text-added') {
                        <div class="material-symbols-outlined inverted-icon">add</div> <div>{{log.message}}</div>
                    }
                    @case('text-edited') {
                        <div class="material-symbols-outlined inverted-icon">edit</div> <div>{{log.message}}</div>
                    }
                    @case('text-removed') {
                        <div class="material-symbols-outlined inverted-icon warn-icon">delete</div> <div>{{log.message}}</div>
                    }
                    @case ('text-visibility') {
                        <div class="material-symbols-outlined inverted-icon">visibility</div> <div>{{log.message}}</div>
                    }
                    @case ('text-calendar') {
                        <div class="material-symbols-outlined inverted-icon">calendar_today</div> <div>{{log.message}}</div>
                    }
                    @case ('text-image') {
                        <img src="{{log.imageUrl}}">
                        <div>{{log.message}}</div>
                    }
                    @case ('text-trophy') {
                        <div class="material-symbols-outlined inverted-icon">trophy</div> <div>{{log.message}}</div>
                    }
                }
            </div>
            
            <!-- <div>{{log.message}}</div> -->
        } @empty {
            <div class="no-logs">
                <div>Nessuna notifica presente.</div>
            </div>
        }
    </div>
}

@if (selectedLog) {
    <div class="notification-container">
        @switch(selectedLog.type) {
            @case ('text-added') {
                <div class="material-symbols-outlined inverted-icon">add</div> <div>{{selectedLog.message}}</div>
            }
            @case('text-edited') {
                <div class="material-symbols-outlined inverted-icon">edit</div> <div>{{selectedLog.message}}</div>
            }
            @case('text-removed') {
                <div class="material-symbols-outlined inverted-icon warn-icon">delete</div> <div>{{selectedLog.message}}</div>
            }
            @case ('text-visibility') {
                <div class="material-symbols-outlined inverted-icon">visibility</div> <div>{{selectedLog.message}}</div>
            }
            @case ('text-calendar') {
                <div class="material-symbols-outlined inverted-icon">calendar_today</div> <div>{{selectedLog.message}}</div>
            }
            @case ('text-image') {
                <img src="{{selectedLog.imageUrl}}">
                <div>{{selectedLog.message}}</div>
            }
            @case ('text-trophy') {
                <div class="material-symbols-outlined inverted-icon">trophy</div> <div>{{selectedLog.message}}</div>
            }
        }
    </div>
}

<!-- <div class="dice-buttons" id="dice-button" *ngIf="campaignData && campaignData.dddiceSlug !== undefined">
    <button class="step-button" mat-icon-button (click)="openDiceSelector()" matTooltip="Dadi"
        matTooltipPosition="right" [disabled]="campaignData.dddiceSlug === ''">
        <img src="./assets/dice/dice-d20-white.svg" alt="">
    </button>
</div> -->

<!-- <div class="dice-buttons" id="dice-button" *ngIf="campaignData && campaignData.dddiceSlug !== undefined">
    <button class="step-button" mat-icon-button (click)="openDiceSelector()" matTooltip="Dadi"
        matTooltipPosition="right" disabled>
        <img src="./assets/dice/dice-d20-white.svg" alt="">
    </button>
</div> -->

<app-description-tooltip id="tab1-tooltip" info="storia" *ngIf="tooltip.show && tooltip.id === 'tab1-tooltip'" [ngStyle]="{'top.px': tooltip.tooltipPosition.top, 'left.px': tooltip.tooltipPosition.left}"></app-description-tooltip>
<app-description-tooltip id="tab2-tooltip" info="missioni" *ngIf="tooltip.show && tooltip.id === 'tab2-tooltip'" [ngStyle]="{'top.px': tooltip.tooltipPosition.top, 'left.px': tooltip.tooltipPosition.left}"></app-description-tooltip>
<app-description-tooltip id="tab3-tooltip" info="pngOrganizzazioni" *ngIf="tooltip.show && tooltip.id === 'tab3-tooltip'" [ngStyle]="{'top.px': tooltip.tooltipPosition.top, 'left.px': tooltip.tooltipPosition.left}"></app-description-tooltip>
<app-description-tooltip id="tab4-tooltip" info="inventarioCampagna" *ngIf="tooltip.show && tooltip.id === 'tab4-tooltip'" [ngStyle]="{'top.px': tooltip.tooltipPosition.top, 'left.px': tooltip.tooltipPosition.left}"></app-description-tooltip>
<app-description-tooltip id="tab5-tooltip" info="annotazioni" *ngIf="tooltip.show && tooltip.id === 'tab5-tooltip'" [ngStyle]="{'top.px': tooltip.tooltipPosition.top, 'left.px': tooltip.tooltipPosition.left}"></app-description-tooltip>
<app-description-tooltip id="tab6-tooltip" info="trofei" *ngIf="tooltip.show && tooltip.id === 'tab6-tooltip'" [ngStyle]="{'top.px': tooltip.tooltipPosition.top, 'left.px': tooltip.tooltipPosition.left}"></app-description-tooltip>
<app-description-tooltip id="tab7-tooltip" info="incontri" *ngIf="tooltip.show && tooltip.id === 'tab7-tooltip'" [ngStyle]="{'top.px': tooltip.tooltipPosition.top, 'left.px': tooltip.tooltipPosition.left}"></app-description-tooltip>    
<app-description-tooltip id="tab8-tooltip" info="schermoMaster" *ngIf="tooltip.show && tooltip.id === 'tab8-tooltip'" [ngStyle]="{'top.px': tooltip.tooltipPosition.top, 'left.px': tooltip.tooltipPosition.left}"></app-description-tooltip>
<app-description-tooltip id="tab9-tooltip" info="impostazioniCampagna" *ngIf="tooltip.show && tooltip.id === 'tab9-tooltip'" [ngStyle]="{'top.px': tooltip.tooltipPosition.top, 'left.px': tooltip.tooltipPosition.left}"></app-description-tooltip>
